var a,b;a=this,b=function(){"use strict";function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function t(e){return e.innerHTML=""}function n(e,n,i,r,s,a){r({event:e,query:n instanceof HTMLInputElement?n.value:n.innerHTML,matches:s.matches,results:s.list.map(function(e){return e.value}),selection:s.list.find(function(t){return e.keyCode===u?t.index===Number(a.getAttribute(o)):"mousedown"===e.type?t.index===Number(e.currentTarget.getAttribute(o)):void 0})}),t(i)}function i(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}var o="data-id",r="autoComplete_list",s="autoComplete_result",a="autoComplete_highlighted",l="autoComplete_selected",u=13,c=38,d=40,h=function(e){return"string"==typeof e?document.querySelector(e):e()},v=function(e){var t=document.createElement(e.element);return t.setAttribute("id",r),e.container&&e.container(t),e.destination.insertAdjacentElement(e.position,t),t},f=function(e){return"<span class=".concat(a,">").concat(e,"</span>")},m=function(e,t,n){var i=document.createDocumentFragment();t.forEach(function(e,r){var a=document.createElement(n.element),l=t[r].index;a.setAttribute(o,l),a.setAttribute("class",s),n.content?n.content(e,a):a.innerHTML=e.match||e,i.appendChild(a)}),e.appendChild(i)},p=function(e,t,i,o){function r(e){f.classList.remove(l),a=1===e?f.nextSibling:f.previousSibling}function s(e){(f=e).classList.add(l)}var a,h=t.childNodes,v=h.length-1,f=void 0;e.onkeydown=function(l){if(0<h.length)switch(l.keyCode){case c:f?(r(0),s(a||h[v])):s(h[v]);break;case d:f?(r(1),s(a||h[0])):s(h[0]);break;case u:f&&n(l,e,t,i,o,f)}},h.forEach(function(r){r.onmousedown=function(r){return n(r,e,t,i,o)}})},g=t;i.prototype=window.Event.prototype;var y={CustomEventWrapper:"function"==typeof window.CustomEvent&&window.CustomEvent||i,initElementClosestPolyfill:function(){Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(e){var t=this;do{if(t.matches(e))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType);return null})}};return function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=e.selector,i=void 0===n?"#autoComplete":n,o=e.data,r=o.key,s=o.src,a=o.cache,l=void 0===a||a,u=e.query,c=e.trigger,d=(c=void 0===c?{}:c).event,f=void 0===d?["input"]:d,m=c.condition,p=void 0!==m&&m,g=e.searchEngine,y=void 0===g?"strict":g,b=e.threshold,E=void 0===b?0:b,w=e.debounce,C=void 0===w?0:w,L=e.resultsList,k=(L=void 0===L?{}:L).render,S=void 0!==k&&k,x=L.container,R=void 0!==x&&x,q=L.destination,M=L.position,T=void 0===M?"afterend":M,H=L.element,A=void 0===H?"ul":H,P=L.navigation,I=void 0!==P&&P,j=e.sort,N=void 0!==j&&j,_=e.placeHolder,V=e.maxResults,W=void 0===V?5:V,D=e.resultItem,F=(D=void 0===D?{}:D).content,O=void 0!==F&&F,z=D.element,B=void 0===z?"li":z,G=e.noResults,J=e.highlight,K=void 0!==J&&J,Q=e.onSelection,U=S?v({container:R,destination:q||h(i),position:T,element:A}):null;this.selector=i,this.data={src:function(){return"function"==typeof s?s():s},key:r,cache:l},this.query=u,this.trigger={event:f,condition:p},this.searchEngine="loose"===y?"loose":"function"==typeof y?y:"strict",this.threshold=E,this.debounce=C,this.resultsList={render:S,view:U,navigation:I},this.sort=N,this.placeHolder=_,this.maxResults=W,this.resultItem={content:O,element:B},this.noResults=G,this.highlight=K,this.onSelection=Q,this.init()}return n=t,i=[{key:"search",value:function(e,t){var n=t.toLowerCase();if("loose"===this.searchEngine){e=e.replace(/ /g,"");for(var i=[],o=0,r=0;r<n.length;r++){var s=t[r];o<e.length&&n[r]===e[o]&&(s=this.highlight?f(s):s,o++),i.push(s)}return o===e.length&&i.join("")}if(n.includes(e))return e=new RegExp("".concat(e),"i").exec(t),this.highlight?t.replace(e,f(e)):t}},{key:"listMatchedResults",value:function(e){var t=this;return new Promise(function(n){var i=[];e.filter(function(e,n){function o(o){var r=o?e[o]:e;if(r){var s="function"==typeof t.searchEngine?t.searchEngine(t.queryValue,r):t.search(t.queryValue,r);s&&o?i.push({key:o,index:n,match:s,value:e}):s&&!o&&i.push({index:n,match:s,value:e})}}if(t.data.key){var r=!0,s=!1,a=void 0;try{for(var l,u=t.data.key[Symbol.iterator]();!(r=(l=u.next()).done);r=!0)o(l.value)}catch(o){s=!0,a=o}finally{try{r||null==u.return||u.return()}finally{if(s)throw a}}}else o()});var o=t.sort?i.sort(t.sort).slice(0,t.maxResults):i.slice(0,t.maxResults);return n({matches:i.length,list:o})})}},{key:"ignite",value:function(){function e(e){Promise.resolve(t.data.cache?t.dataStream:t.data.src()).then(function(i){t.dataStream=i,function(e){function i(e,t){n.dispatchEvent(new y.CustomEventWrapper("autoComplete",{bubbles:!0,detail:{event:e,input:o,query:r,matches:t?t.matches:null,results:t?t.list:null},cancelable:!0}))}var o=n instanceof HTMLInputElement?n.value.toLowerCase():n.innerHTML.toLowerCase(),r=t.queryValue=t.query&&t.query.manipulate?t.query.manipulate(o):o,s=t.resultsList.render,a=t.trigger.condition?t.trigger.condition(r):r.length>t.threshold&&r.replace(/ /g,"").length;if(s){var l=t.resultsList.view;g(l),a?t.listMatchedResults(t.dataStream,e).then(function(o){i(e,o),t.resultsList.render&&(0===o.list.length&&t.noResults?t.noResults():(m(l,o.list,t.resultItem),t.onSelection&&(t.resultsList.navigation?t.resultsList.navigation(e,n,l,t.onSelection,o):p(n,l,t.onSelection,o))))}):i(e)}else!s&&a&&t.listMatchedResults(t.dataStream,e).then(function(t){i(e,t)})}(e)})}var t=this,n=h(this.selector);this.placeHolder&&n.setAttribute("placeholder",this.placeHolder),this.trigger.event.forEach(function(i){var o,r,s;n.addEventListener(i,(o=function(t){return e(t)},r=t.debounce,function(){var e=this,t=arguments;clearTimeout(s),s=setTimeout(function(){return o.apply(e,t)},r)}))})}},{key:"init",value:function(){var e=this;this.data.cache?Promise.resolve(this.data.src()).then(function(t){e.dataStream=t,e.ignite()}):this.ignite(),y.initElementClosestPolyfill()}}],i&&e(n.prototype,i),o&&e(n,o),t;var n,i,o}()},"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):a.autoComplete=b();